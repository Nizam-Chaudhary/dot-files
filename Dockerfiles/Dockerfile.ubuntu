FROM ubuntu:24.04

# ----------------------------------------------------------
# Environment
# ----------------------------------------------------------
ENV DEBIAN_FRONTEND=noninteractive
ENV TERM=xterm-256color

# ----------------------------------------------------------
# System dependencies
# ----------------------------------------------------------
RUN apt-get update \
  && apt-get install -y --no-install-recommends \
      git \
      stow \
      curl \
      ca-certificates \
      sudo \
      bash \
      build-essential \
  && rm -rf /var/lib/apt/lists/*

# ----------------------------------------------------------
# Create non-root test user
# ----------------------------------------------------------
ARG USERNAME=test
ARG UID=1010
ARG GID=1010

RUN groupadd -g ${GID} ${USERNAME} \
    && useradd -m -u ${UID} -g ${GID} -s /bin/bash ${USERNAME} \
    && echo "${USERNAME} ALL=(ALL) NOPASSWD:ALL" > /etc/sudoers.d/${USERNAME} \
    && chmod 0440 /etc/sudoers.d/${USERNAME}

# ----------------------------------------------------------
# Switch to user
# ----------------------------------------------------------
USER ${USERNAME}
ENV HOME=/home/${USERNAME}
WORKDIR ${HOME}

# ----------------------------------------------------------
# Default shell (interactive testing)
# ----------------------------------------------------------
SHELL ["/bin/bash", "-lc"]
CMD ["bash"]
